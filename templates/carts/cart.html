{% extends 'base.html' %}
{% block title %}Your Shopping Cart | Premium Collection{% endblock %}

{% block content %}
<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .cart-item {
    animation: fadeIn 0.3s ease-out forwards;
    opacity: 0;
  }
  
  .cart-item:nth-child(1) { animation-delay: 0.1s; }
  .cart-item:nth-child(2) { animation-delay: 0.2s; }
  .cart-item:nth-child(3) { animation-delay: 0.3s; }
  .cart-item:nth-child(4) { animation-delay: 0.4s; }
  
  .yellow-accent-bg {
    background-color: #fde047;
  }
  
  .yellow-accent-text {
    color: #fde047;
  }
  
  .yellow-accent-border {
    border-color: #fde047;
  }
  
  .yellow-accent-hover:hover {
    background-color: #facc15;
  }
  
  .quantity-selector {
    display: flex;
    align-items: center;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
  }
  
  .quantity-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f3f4f6;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .quantity-btn:hover {
    background-color: #e5e7eb;
  }
  
  .quantity-input {
    width: 40px;
    text-align: center;
    border: none;
    border-left: 1px solid #e5e7eb;
    border-right: 1px solid #e5e7eb;
    -moz-appearance: textfield;
  }
  
  .quantity-input::-webkit-outer-spin-button,
  .quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  .discount-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: linear-gradient(135deg, #f59e0b 0%, #fde047 100%);
    color: #111827;
    font-weight: 700;
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 9999px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    z-index: 10;
  }
  
  .summary-card {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border-radius: 12px;
    position: sticky;
    top: 20px;
  }
  
  .empty-cart-icon {
    animation: float 3s ease-in-out infinite;
  }
  
  @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
  }
</style>

<div class="bg-gray-50 min-h-screen py-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8 text-center">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Your Shopping Cart</h1>
      <p class="mt-2 text-lg text-gray-600">
        {% if cart_items %}
        Review your premium selections
        {% else %}
        Your cart is waiting to be filled with exceptional finds
        {% endif %}
      </p>
    </div>

    {% if cart_items %}
    <div class="grid gap-8 lg:grid-cols-3">
      <!-- Cart Items -->
      <div class="space-y-6 lg:col-span-2">
        {% for cart_item in cart_items %}
        <div class="cart-item bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="flex flex-col sm:flex-row">
            <!-- Product Image -->
            <div class="relative w-full sm:w-48 h-48 bg-gray-100 flex-shrink-0">
              <a href="{{ cart_item.product.get_absolute_url }}">
                <img
                  src="{{ cart_item.product.image.url }}"
                  alt="{{ cart_item.product.product_name }}"
                  class="w-full h-full object-contain p-4"
                  loading="lazy"
                />
              </a>
              {% if cart_item.product.discount %}
              <div class="discount-badge">
                {% if cart_item.product.discount_type == 'percent' %}
                SAVE {{ cart_item.product.discount }}%
                {% else %}
                SPECIAL OFFER
                {% endif %}
              </div>
              {% endif %}
            </div>
            
            <!-- Product Info -->
            <div class="flex-1 p-6">
              <div class="flex flex-col h-full">
                <div class="flex-1">
                  <a href="{{ cart_item.product.get_absolute_url }}" class="block">
                    <h3 class="text-xl font-semibold text-gray-900 hover:text-yellow-500 transition-colors">
                      {{ cart_item.product.product_name }}
                    </h3>
                  </a>
                  
                  <!-- Variations -->
                  {% if cart_item.variations.all %}
                  <div class="mt-2 space-y-1">
                    {% for item in cart_item.variations.all %}
                    <p class="text-sm text-gray-600">
                      <span class="font-medium">{{ item.variation_category|capfirst }}:</span> 
                      {{ item.variation_value|capfirst }}
                    </p>
                    {% endfor %}
                  </div>
                  {% endif %}
                  
                  <!-- Stock Status -->
                  <div class="mt-3 flex items-center">
                    {% if cart_item.product.stock > 10 %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      In Stock
                    </span>
                    {% elif cart_item.product.stock > 0 %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                      Only {{ cart_item.product.stock }} left
                    </span>
                    {% else %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                      Out of Stock
                    </span>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Price and Actions -->
                <div class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
                  <!-- Price -->
                  <div class="mb-4 sm:mb-0">
                    <p class="text-2xl font-bold text-gray-900">
                      ${{ cart_item.sub_total }}
                    </p>
                    {% if cart_item.total_discount > 0 %}
                    <p class="text-sm text-gray-500 line-through">${{ cart_item.total_discount }}</p>
                    {% endif %}
                  </div>
                  
                  <!-- Quantity Selector -->
                  <div class="flex items-center space-x-6">
                    <form action="{% url 'cart' %}" method="POST" class="flex items-center">
                      {% csrf_token %}
                      <input type="hidden" name="product_id" value="{{ cart_item.product.id }}">
                      <input type="hidden" name="cart_item_id" value="{{ cart_item.id }}">
                      
                      <div class="quantity-selector">
                        <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" class="quantity-btn">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                          </svg>
                        </a>
                        <input
                          type="number"
                          name="quantity"
                          value="{{ cart_item.quantity }}"
                          min="1"
                          max="{{ cart_item.product.stock }}"
                          class="quantity-input h-8 text-sm"
                          onchange="this.form.submit()"
                        />
                        <a href="{% url 'add_cart' cart_item.product.id %}" class="quantity-btn">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                          </svg>
                        </a>
                      </div>
                    </form>
                    
                    <!-- Remove Button -->
                    <a 
                      href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" 
                      onclick="return confirm('Are you sure you want to remove this item from your cart?')"
                      class="text-red-500 hover:text-red-700 transition-colors"
                    >
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      
      <!-- Order Summary -->
      <div class="summary-card bg-white p-6 h-fit">
        <h3 class="text-xl font-bold text-gray-900 border-b pb-4">
          Order Summary
        </h3>
        
        <div class="mt-6 space-y-4">
          <div class="flex justify-between">
            <span class="text-gray-600">Subtotal ({{ quantity }} items)</span>
            <span class="font-medium">${{ total }}</span>
          </div>
          
          <div class="flex justify-between">
            <span class="text-gray-600">Shipping</span>
            <span class="font-medium">${{ shipping_fee }}</span>
          </div>
          
          <div class="flex justify-between">
            <span class="text-gray-600">Tax</span>
            <span class="font-medium">${{ tax }}</span>
          </div>
          
          <div class="border-t border-gray-200 pt-4 flex justify-between">
            <span class="text-lg font-bold text-gray-900">Total</span>
            <span class="text-lg font-bold text-gray-900">${{ grand_total }}</span>
          </div>
          
          <div class="pt-4">
            <a href="{% url 'place_order' %}">
              <button class="w-full yellow-accent-bg yellow-accent-hover text-gray-900 font-bold py-3 px-4 rounded-lg shadow-lg transition duration-300 transform hover:scale-105">
                Proceed to Checkout
              </button>
            </a>
          </div>
          
          <div class="pt-2">
            <a href="{% url 'products' %}" class="block text-center text-indigo-600 hover:text-indigo-800 font-medium mt-2">
              Continue Shopping
            </a>
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <!-- Empty Cart State -->
    <div class="text-center py-16">
      <div class="mx-auto h-32 w-32 text-gray-400 empty-cart-icon">
        <svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
      </div>
      <h3 class="mt-6 text-2xl font-bold text-gray-900">Your Cart is Empty</h3>
      <p class="mt-3 text-lg text-gray-600 max-w-md mx-auto">
        Discover our premium collection and find something special
      </p>
      <div class="mt-6">
        <a href="{% url 'products' %}" class="yellow-accent-bg yellow-accent-hover text-gray-900 font-bold px-8 py-3 rounded-lg shadow-lg inline-flex items-center transition duration-300">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          Browse Products
        </a>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
  // Update quantity when changed
  document.querySelectorAll('.quantity-input').forEach(input => {
    input.addEventListener('change', function() {
      if (this.value < 1) this.value = 1;
      if (this.value > parseInt(this.max)) this.value = this.max;
      this.form.submit();
    });
  });
</script>
{% endblock %}